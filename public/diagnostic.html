<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico App.html</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #f0f0f0; }
        .log { background: white; border-radius: 4px; padding: 10px; margin: 5px 0; border-left: 4px solid #007cba; }
        .error { border-left-color: #dc3545; background: #fff5f5; }
        .success { border-left-color: #28a745; background: #f5fff5; }
        .warning { border-left-color: #ffc107; background: #fffef5; }
        .console-output { background: #000; color: #0f0; padding: 15px; border-radius: 4px; margin: 10px 0; font-family: 'Courier New', monospace; }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico de App.html</h1>
    
    <div id="status"></div>
    
    <h3>üìã Console Output:</h3>
    <div id="console-output" class="console-output"></div>
    
    <h3>üîß Test de Funciones:</h3>
    <div id="function-tests"></div>
    
    <script>
        const statusDiv = document.getElementById('status');
        const consoleDiv = document.getElementById('console-output');
        const functionDiv = document.getElementById('function-tests');
        
        // Capturar todos los logs de consola
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToConsole(type, ...args) {
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'warn' ? '#feca57' : '#0f0';
            
            consoleDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${type.toUpperCase()}: ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        console.log = (...args) => {
            originalLog.apply(console, args);
            addToConsole('log', ...args);
        };
        
        console.error = (...args) => {
            originalError.apply(console, args);
            addToConsole('error', ...args);
        };
        
        console.warn = (...args) => {
            originalWarn.apply(console, args);
            addToConsole('warn', ...args);
        };
        
        function addStatus(message, type = 'log') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            statusDiv.appendChild(div);
        }
        
        // Funci√≥n para testear las funciones globales
        function testGlobalFunctions() {
            addStatus('üß™ Testeando funciones globales...', 'log');
            
            const tests = [
                { name: 'crearNuevoPedido', func: window.crearNuevoPedido },
                { name: 'diagnosticoSistema', func: window.diagnosticoSistema },
                { name: 'reiniciarSistema', func: window.reiniciarSistema },
                { name: 'app', func: window.app }
            ];
            
            tests.forEach(test => {
                const exists = typeof test.func !== 'undefined';
                const type = typeof test.func;
                
                functionDiv.innerHTML += `
                    <div class="log ${exists ? 'success' : 'error'}">
                        <strong>${test.name}:</strong> ${exists ? '‚úÖ Existe' : '‚ùå No existe'} 
                        <em>(tipo: ${type})</em>
                        ${exists && type === 'function' ? 
                            `<button onclick="testFunction('${test.name}')" style="margin-left: 10px;">üß™ Probar</button>` : 
                            ''
                        }
                    </div>
                `;
            });
        }
        
        window.testFunction = function(funcName) {
            addStatus(`üß™ Probando funci√≥n: ${funcName}`, 'log');
            
            try {
                const result = window[funcName]();
                addStatus(`‚úÖ ${funcName}() ejecutado correctamente. Resultado: ${result}`, 'success');
            } catch (error) {
                addStatus(`‚ùå Error ejecutando ${funcName}(): ${error.message}`, 'error');
            }
        };
        
        // Monitorear cuando window.app est√© disponible
        let appCheckInterval;
        function checkApp() {
            if (window.app) {
                addStatus('‚úÖ window.app est√° disponible', 'success');
                addStatus(`üìä app.isInitialized: ${window.app.isInitialized}`, 'log');
                clearInterval(appCheckInterval);
                
                // Testear funciones despu√©s de que app est√© disponible
                setTimeout(testGlobalFunctions, 1000);
            } else {
                addStatus('‚è≥ Esperando window.app...', 'warning');
            }
        }
        
        // Inicializar
        addStatus('üöÄ Iniciando diagn√≥stico...', 'log');
        addStatus(`üìç URL actual: ${window.location.href}`, 'log');
        addStatus(`üåê User Agent: ${navigator.userAgent}`, 'log');
        
        // Verificar cada segundo si app est√° disponible
        appCheckInterval = setInterval(checkApp, 1000);
        
        // Capturar errores no manejados
        window.addEventListener('error', (event) => {
            addStatus(`üí• Error no manejado: ${event.error.message}`, 'error');
            addStatus(`üìÅ Archivo: ${event.filename}:${event.lineno}:${event.colno}`, 'error');
        });
        
        // Capturar promesas rechazadas
        window.addEventListener('unhandledrejection', (event) => {
            addStatus(`üí• Promesa rechazada: ${event.reason}`, 'error');
        });
        
        // Log inicial
        console.log('üîç Diagn√≥stico iniciado');
        
        // Timeout de seguridad
        setTimeout(() => {
            if (!window.app) {
                addStatus('‚ö†Ô∏è Timeout: window.app no se inicializ√≥ en 30 segundos', 'error');
                testGlobalFunctions(); // Testear de todas formas
            }
        }, 30000);
    </script>
</body>
</html>